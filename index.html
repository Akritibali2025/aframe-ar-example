<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Winter AR Scene â€¢ A-Frame</title>
    <meta name="description" content="Place snowmen and pine trees in AR using A-Frame">
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script>
      // Optional: follow-shadow component from your previous code
      AFRAME.registerComponent('follow-shadow', {
        schema: {type: 'selector'},
        init() { this.el.object3D.renderOrder = -1; },
        tick() {
          if (this.data) {
            this.el.object3D.position.copy(this.data.object3D.position);
            this.el.object3D.position.y -= 0.001; // prevent z-fighting
          }
        }
      });
    </script>
  </head>

  <body>
    <a-scene
      reflection="directionalLight: a-light[type=directional]"
      ar-hit-test="target: #objects;"
      renderer="colorManagement: true; exposure: 1; toneMapping: ACESFilmic"
      shadow="type: pcfsoft"
      xr-mode-ui="XRMode: xr"
    >
      <!-- Light -->
      <a-light type="directional" light="castShadow:true;" position="1 1 1" intensity="1.57" shadow-camera-automatic="#objects"></a-light>

      <!-- Camera -->
      <a-camera position="0 0.4 0" wasd-controls="acceleration:10;"></a-camera>

      <!-- Templates (hidden) -->
      <a-entity id="snowman-template" visible="false">
        <a-sphere radius="0.25" position="0 0.25 0" color="#FFFFFF"></a-sphere>
        <a-sphere radius="0.18" position="0 0.6 0" color="#FFFFFF"></a-sphere>
        <a-sphere radius="0.12" position="0 0.9 0" color="#FFFFFF"></a-sphere>
        <a-cone radius-bottom="0.02" radius-top="0" height="0.08"
                color="orange" position="0 0.9 0.12" rotation="90 0 0">
        </a-cone>
      </a-entity>

      <a-entity id="tree-template" visible="false">
        <a-cylinder radius="0.05" height="0.2" color="#8B5A2B" position="0 0.1 0"></a-cylinder>
        <a-cone radius-bottom="0.3" radius-top="0" height="0.6" color="#0B6623" position="0 0.5 0"></a-cone>
      </a-entity>

      <!-- Reticle -->
      <a-entity id="reticle"
                ar-hit-test="target:#objects"
                visible="false"
                geometry="primitive: ring; radiusInner: 0.08; radiusOuter: 0.1"
                material="color: yellow; shader: flat"
                rotation="-90 0 0">
      </a-entity>

      <!-- Container for spawned objects -->
      <a-entity id="objects"></a-entity>

      <!-- Floor shadow -->
      <a-plane follow-shadow="#objects" material="shader:shadow" shadow="cast:false;" rotation="-90 0 0" width="5" height="5"></a-plane>

      <!-- Sky -->
      <a-sky color="#ECECEC" hide-on-enter-ar></a-sky>
    </a-scene>

    <!-- Tap-to-spawn script -->
    <script>
      const scene = document.querySelector('a-scene');
      const reticle = document.querySelector('#reticle');
      const snowmanTemplate = document.querySelector('#snowman-template');
      const treeTemplate = document.querySelector('#tree-template');

      document.addEventListener('click', () => {
        // Use reticle position if visible, else default
        const spawnPosition = reticle.object3D.visible ? reticle.getAttribute('position') : {x:0, y:0, z:-1};

        // Randomly choose snowman or tree
        const template = Math.random() < 0.5 ? snowmanTemplate : treeTemplate;

        // Clone template
        const obj = template.cloneNode(true);
        obj.setAttribute('visible', true);

        // Random rotation
        obj.setAttribute('rotation', {x: 0, y: Math.random() * 360, z: 0});

        // Random scale between 0.8 and 1.2
        const scale = 0.8 + Math.random() * 0.4;
        obj.setAttribute('scale', {x: scale, y: scale, z: scale});

        // Set position
        obj.setAttribute('position', spawnPosition);

        // Add to scene
        scene.appendChild(obj);
      });
    </script>
  </body>
</html>
